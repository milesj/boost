"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4360],{7e3:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>m,frontMatter:()=>a,metadata:()=>d,toc:()=>p});var t=r(1948),s=r(3460),o=r(302),l=r(240),i=r(2548);const a={title:"Modules"},c=void 0,d={id:"module",title:"Modules",description:"Load and resolve custom file types at runtime with a Node.js require replacement or",source:"@site/docs/module.mdx",sourceDirName:".",slug:"/module",permalink:"/docs/module",draft:!1,unlisted:!1,editUrl:"https://github.com/milesj/boost/edit/master/website/docs/module.mdx",tags:[],version:"current",frontMatter:{title:"Modules"},sidebar:"docs",previous:{title:"Logging",permalink:"/docs/log"},next:{title:"Pipelines",permalink:"/docs/pipeline"}},u={},p=[{value:"Installation",id:"installation",level:2},{value:"CommonJS requires",id:"commonjs-requires",level:2},{value:"Module interoperability",id:"module-interoperability",level:3},{value:"Generic types",id:"generic-types",level:3},{value:"Node.js hooks",id:"nodejs-hooks",level:2},{value:"Supported file types",id:"supported-file-types",level:2},{value:"TypeScript",id:"typescript",level:3}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.c,{backend:!0,tooling:!0,api:"/api/module"}),"\n",(0,t.jsxs)(n.p,{children:["Load and resolve custom file types at runtime with a Node.js ",(0,t.jsx)(n.code,{children:"require"})," replacement or\nnext-generation ",(0,t.jsx)(n.a,{href:"https://nodejs.org/api/module.html#customization-hooks",children:"hooks"}),". Currently supports\nTypeScript for ",(0,t.jsx)(n.code,{children:".ts"})," and ",(0,t.jsx)(n.code,{children:".tsx"})," files."]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsxs)(l.c,{groupId:"package-manager",defaultValue:"yarn",values:[{label:"Yarn",value:"yarn"},{label:"pnpm",value:"pnpm"},{label:"npm",value:"npm"}],children:[(0,t.jsx)(i.c,{value:"yarn",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn add @boost/module\n"})})}),(0,t.jsx)(i.c,{value:"pnpm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm add @boost/module\n"})})}),(0,t.jsx)(i.c,{value:"npm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install @boost/module\n"})})})]}),"\n",(0,t.jsx)(n.h2,{id:"commonjs-requires",children:"CommonJS requires"}),"\n",(0,t.jsxs)(n.p,{children:["Node.js's native ",(0,t.jsx)(n.code,{children:"require()"})," has historically only supported ",(0,t.jsx)(n.code,{children:".js"})," and ",(0,t.jsx)(n.code,{children:".json"})," files (and now ",(0,t.jsx)(n.code,{children:".cjs"}),"\ntoo). But what if we were able to require non-JavaScript files at runtime also? Like TypeScript?\nThis package does just that through a new function called ",(0,t.jsx)(n.a,{href:"/api/module/function/requireModule",children:(0,t.jsx)(n.code,{children:"requireModule()"})}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["This function operates by patching the list of allowed file types/extensions in Node.js's module\nresolution. Begin by importing the function and importing\n",(0,t.jsx)(n.a,{href:"#supported-file-types",children:"a supported file type"}),"!"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { requireModule } from '@boost/module';\n\nconst result = requireModule('./some/non-js/file');\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["This function should only be used to import module-like files, like JavaScript and TypeScript. It\nshould ",(0,t.jsx)(n.em,{children:"not"})," be used for other file types, like JSON or YAML."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If you'd prefer to ",(0,t.jsx)(n.em,{children:"not"})," use ",(0,t.jsx)(n.code,{children:"requireModule()"})," and still use native ",(0,t.jsx)(n.code,{children:"require()"}),", but also support\ncustom file types, you may do so by calling\n",(0,t.jsx)(n.a,{href:"/api/module/function/registerExtensions",children:(0,t.jsx)(n.code,{children:"registerExtensions()"})})," at the top of your script or\napplication entry point."]}),"\n",(0,t.jsx)(n.h3,{id:"module-interoperability",children:"Module interoperability"}),"\n",(0,t.jsxs)(n.p,{children:["Unlike ",(0,t.jsx)(n.code,{children:"require()"})," which returns imported values as-is, ",(0,t.jsx)(n.a,{href:"/api/module/function/requireModule",children:(0,t.jsx)(n.code,{children:"requireModule()"})})," changes\nthe shape of the import to align with ECMAScript modules. We do this for interoperability and\nconsistency sake, so that the developer experience is the same for both systems."]}),"\n",(0,t.jsxs)(n.p,{children:["So what does this mean exactly? The biggest change is that CommonJS default exports\n(",(0,t.jsx)(n.code,{children:"module.exports"}),") are now returned under a ",(0,t.jsx)(n.code,{children:"default"})," property, like so."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="example.js"',children:"module.exports = 123;\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const value = require('./example'); // 123\nconst { default: value } = requireModule('./example'); // 123\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Another change is that CommonJS named exports (",(0,t.jsx)(n.code,{children:"exports.<name>"}),") are returned as properties in the\nimported object, as well as properties in an object on the ",(0,t.jsx)(n.code,{children:"default"})," property. This pattern exists\nto match Node.js >= v12.20 functionality."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="example.js"',children:"exports.foo = 'abc';\nexports.bar = 123;\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const value = require('./example');\nvalue.foo; // abc\nvalue.bar; // 123\n\nconst value = requireModule('./example');\nvalue.foo; // abc\nvalue.bar; // 123\nvalue.foo === value.default.foo; // true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"generic-types",children:"Generic types"}),"\n",(0,t.jsxs)(n.p,{children:["In TypeScript, the native ",(0,t.jsx)(n.code,{children:"require()"})," is typed to return ",(0,t.jsx)(n.code,{children:"any"}),", which isn't that ideal. However,\n",(0,t.jsx)(n.a,{href:"/api/module/function/requireModule",children:(0,t.jsx)(n.code,{children:"requireModule()"})})," can type both the default and named exports of a module via\ngenerics."]}),"\n",(0,t.jsxs)(n.p,{children:["The 1st generic slot types the default export (",(0,t.jsx)(n.code,{children:"module.exports"})," for CJS and ",(0,t.jsx)(n.code,{children:"export default"})," for\nESM) under the returned ",(0,t.jsx)(n.code,{children:"default"})," property."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const result = requireModule<string>('./example');\nresult.default; // string\n"})}),"\n",(0,t.jsxs)(n.p,{children:["While the 2nd generic slot types named exports (",(0,t.jsx)(n.code,{children:"exports.<name>"})," for CJS and ",(0,t.jsx)(n.code,{children:"export <name>"})," for\nESM) under their respective property names."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const result = requireModule<string, { foo: string; bar: number }>('./example');\nresult.foo; // string\nresult.bar; // number\nresult.default; // string\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For backwards compatibility with CommonJS (can't mix ",(0,t.jsx)(n.code,{children:"module.exports"})," and ",(0,t.jsx)(n.code,{children:"exports.<name>"}),"), named\nexports are also encapsulated under the ",(0,t.jsx)(n.code,{children:"default"})," property. To type this correctly, pass ",(0,t.jsx)(n.code,{children:"void"})," for\nthe default generic, which passes the type through accordingly."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const result = requireModule<void, { foo: string; bar: number }>('./example');\nresult.foo; // string\nresult.bar; // number\nresult.default.foo; // string\nresult.default.bar; // number\n"})}),"\n",(0,t.jsx)(n.h2,{id:"nodejs-hooks",children:"Node.js hooks"}),"\n",(0,t.jsxs)(n.p,{children:["Node.js supports an ",(0,t.jsx)(n.em,{children:"experimental"})," feature called\n",(0,t.jsx)(n.a,{href:"https://nodejs.org/api/module.html#customization-hooks",children:"hooks"}),", where non-JavaScript files can be\nloaded, parsed, and evaluated at runtime through Node.js's module system when using\n",(0,t.jsx)(n.code,{children:"import"}),"/",(0,t.jsx)(n.code,{children:"export"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"To make use of hooks, the following requirements must be met."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Node.js >= v16.20"}),"\n",(0,t.jsxs)(n.li,{children:["Must use ",(0,t.jsx)(n.code,{children:"import()"})," or ",(0,t.jsx)(n.code,{children:"import"}),"/",(0,t.jsx)(n.code,{children:"export"})," syntax (no ",(0,t.jsx)(n.code,{children:"require"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Source files must be modules (",(0,t.jsx)(n.code,{children:".mjs"}),", ",(0,t.jsx)(n.code,{children:".ts"}),", etc)"]}),"\n",(0,t.jsx)(n.li,{children:"Imported files must have trailing file extensions"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"If you meet all of these requirements, then you may run your Node.js script with one of the\nfollowing patterns."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# v20+\nnode --import @boost/module/register ./path/to/entry-point.mjs\n\n# v18+\nnode --loader @boost/module/hook-typescript ./path/to/entry-point.mjs\n\n# v16+\nnode --experimental-loader @boost/module/hook-typescript ./path/to/entry-point.mjs\n"})}),"\n",(0,t.jsx)(n.p,{children:"For example, with the above you can now import TypeScript files as if they were standard JavaScript!"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// entry-point.mjs\nimport defaultValue, { namedValue } from './some/file/written/in.ts';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"supported-file-types",children:"Supported file types"}),"\n",(0,t.jsx)(n.h3,{id:"typescript",children:"TypeScript"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.typescriptlang.org/",children:"TypeScript"})," files are supported for ",(0,t.jsx)(n.code,{children:".ts"}),", ",(0,t.jsx)(n.code,{children:".tsx"}),", ",(0,t.jsx)(n.code,{children:".cts"}),", and\n",(0,t.jsx)(n.code,{children:".mts"})," file extensions. The TypeScript source code will be down-leveled according to the currently\nrunning Node.js version and its capabilities."]}),"\n",(0,t.jsxs)(n.p,{children:["The TypeScript only hook/loader can be referenced with ",(0,t.jsx)(n.code,{children:"@boost/module/hook-typescript"}),"."]})]})}function m(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},2548:(e,n,r)=>{r.d(n,{c:()=>l});r(6952);var t=r(8112);const s={tabItem:"tabItem_wHwb"};var o=r(1948);function l(e){let{children:n,hidden:r,className:l}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,t.c)(s.tabItem,l),hidden:r,children:n})}},240:(e,n,r)=>{r.d(n,{c:()=>h});var t=r(6952),s=r(8112),o=r(320),l=r(500),i=r(6576);const a={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var c=r(1948);function d(e){let{className:n,block:r,selectedValue:t,selectValue:l,tabValues:i}=e;const d=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.MV)(),p=e=>{const n=e.currentTarget,r=d.indexOf(n),s=i[r].value;s!==t&&(u(n),l(s))},h=e=>{var n;let r=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{var t;const n=d.indexOf(e.currentTarget)+1;r=null!=(t=d[n])?t:d[0];break}case"ArrowLeft":{var s;const n=d.indexOf(e.currentTarget)-1;r=null!=(s=d[n])?s:d[d.length-1];break}}null==(n=r)||n.focus()};return(0,c.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.c)("tabs",{"tabs--block":r},n),children:i.map((e=>{let{value:n,label:r,attributes:o}=e;return(0,c.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>d.push(e),onKeyDown:h,onClick:p,...o,className:(0,s.c)("tabs__item",a.tabItem,null==o?void 0:o.className,{"tabs__item--active":t===n}),children:null!=r?r:n},n)}))})}function u(e){let{lazy:n,children:r,selectedValue:s}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===s));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,c.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function p(e){const n=(0,l.a)(e);return(0,c.jsxs)("div",{className:(0,s.c)("tabs-container",a.tabList),children:[(0,c.jsx)(d,{...e,...n}),(0,c.jsx)(u,{...e,...n})]})}function h(e){const n=(0,i.c)();return(0,c.jsx)(p,{...e,children:(0,l.A)(e.children)},String(n))}},500:(e,n,r)=>{r.d(n,{A:()=>c,a:()=>h});var t=r(6952),s=r(7976),o=r(2508),l=r(440),i=r(2484),a=r(900);function c(e){var n,r;return null!=(n=null==(r=t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:r.filter(Boolean))?n:[]}function d(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=null!=n?n:function(e){return c(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:s}}=e;return{value:n,label:r,attributes:t,default:s}}))}(r);return function(e){const n=(0,i.w)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,r])}function u(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:r}=e;const o=(0,s.Uz)(),i=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=r?r:null}({queryString:n,groupId:r});return[(0,l._M)(i),(0,t.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(o.location.search);n.set(i,e),o.replace({...o.location,search:n.toString()})}),[i,o])]}function h(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,l=d(e),[i,c]=(0,t.useState)((()=>function(e){var n;let{defaultValue:r,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!u({value:r,tabValues:t}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+r+'" but none of its children has the corresponding value. Available values are: '+t.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return r}const s=null!=(n=t.find((e=>e.default)))?n:t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:l}))),[h,m]=p({queryString:r,groupId:s}),[x,f]=function(e){let{groupId:n}=e;const r=function(e){return e?"docusaurus.tab."+e:null}(n),[s,o]=(0,a.IN)(r);return[s,(0,t.useCallback)((e=>{r&&o.set(e)}),[r,o])]}({groupId:s}),j=(()=>{const e=null!=h?h:x;return u({value:e,tabValues:l})?e:null})();(0,o.c)((()=>{j&&c(j)}),[j]);return{selectedValue:i,selectValue:(0,t.useCallback)((e=>{if(!u({value:e,tabValues:l}))throw new Error("Can't select invalid tab value="+e);c(e),m(e),f(e)}),[m,f,l]),tabValues:l}}},5392:(e,n,r)=>{r.d(n,{c:()=>s});var t=r(1948);function s(e){let{children:n,type:r}=e;return(0,t.jsx)("span",{className:"badge badge--"+r,children:n})}},302:(e,n,r)=>{r.d(n,{c:()=>c});var t=r(4308),s=r(3752),o=r(5392);const l={badgeGroup:"badgeGroup_syf7",apiLink:"apiLink_JWAN"};var i=r(1948);function a(e){let{children:n}=e;return(0,i.jsx)("span",{className:l.badgeGroup,children:n})}function c(e){let{api:n,backend:r,frontend:c,tooling:d}=e;return(0,i.jsxs)(i.Fragment,{children:[n&&(0,i.jsxs)(t.default,{className:l.apiLink,to:n,children:["API ",(0,i.jsx)(s.c,{})]}),(0,i.jsxs)(a,{children:[r&&(0,i.jsx)(o.c,{type:"warning",children:"Backend"}),c&&(0,i.jsx)(o.c,{type:"success",children:"Frontend"}),d&&(0,i.jsx)(o.c,{type:"primary",children:"Tooling"})]})]})}},3460:(e,n,r)=>{r.d(n,{I:()=>i,M:()=>l});var t=r(6952);const s={},o=t.createContext(s);function l(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);