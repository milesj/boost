<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.64">
<title data-react-helmet="true">Pipelines | Boost</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Pipelines | Boost"><meta data-react-helmet="true" name="description" content="Pipe an input through a series of type-safe routines and tasks to produce an output, or simply, run"><meta data-react-helmet="true" property="og:description" content="Pipe an input through a series of type-safe routines and tasks to produce an output, or simply, run"><meta data-react-helmet="true" property="og:url" content="https://boostlib.dev/docs/pipeline"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://boostlib.dev/docs/pipeline"><link rel="stylesheet" href="/styles.16ab758f.css">
<link rel="preload" href="/styles.258a4895.js" as="script">
<link rel="preload" href="/runtime~main.c839f7c1.js" as="script">
<link rel="preload" href="/main.aad79896.js" as="script">
<link rel="preload" href="/1.bebaefbd.js" as="script">
<link rel="preload" href="/2.7ed9c09b.js" as="script">
<link rel="preload" href="/27.e0fa85a5.js" as="script">
<link rel="preload" href="/28.5b51cd4f.js" as="script">
<link rel="preload" href="/935f2afb.421c7848.js" as="script">
<link rel="preload" href="/17896441.c3526068.js" as="script">
<link rel="preload" href="/0da5837a.fcad377b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Boost"><strong class="navbar__title">Boost</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">v2</a><ul class="dropdown__menu"><li><a href="https://www.npmjs.com/package/@boost/args" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.2.0 路 args</a></li><li><a href="https://www.npmjs.com/package/@boost/cli" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.1 路 cli</a></li><li><a href="https://www.npmjs.com/package/@boost/common" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.2.1 路 common</a></li><li><a href="https://www.npmjs.com/package/@boost/config" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.2.1 路 config</a></li><li><a href="https://www.npmjs.com/package/@boost/debug" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.1 路 debug</a></li><li><a href="https://www.npmjs.com/package/@boost/decorators" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.0.0 路 decorators</a></li><li><a href="https://www.npmjs.com/package/@boost/event" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.0 路 event</a></li><li><a href="https://www.npmjs.com/package/@boost/log" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.1 路 log</a></li><li><a href="https://www.npmjs.com/package/@boost/pipeline" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.1 路 pipeline</a></li><li><a href="https://www.npmjs.com/package/@boost/plugin" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.1 路 plugin</a></li><li><a href="https://www.npmjs.com/package/@boost/terminal" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.0 路 terminal</a></li><li><a href="https://www.npmjs.com/package/@boost/translate" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">v2.1.1 路 translate</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/milesj/boost" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx"></span></div><div class="react-toggle-track-x"><span class="toggle_BsTx"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Boost"><strong class="navbar__title">Boost</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">v2</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/args" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.2.0 路 args</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/cli" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.1 路 cli</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/common" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.2.1 路 common</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/config" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.2.1 路 config</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/debug" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.1 路 debug</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/decorators" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.0.0 路 decorators</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/event" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.0 路 event</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/log" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.1 路 log</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/pipeline" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.1 路 pipeline</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/plugin" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.1 路 plugin</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/terminal" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.0 路 terminal</a></li><li class="menu__list-item"><a href="https://www.npmjs.com/package/@boost/translate" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">v2.1.1 路 translate</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs">Docs</a></li><li class="menu__list-item"><a href="https://github.com/milesj/boost" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Packages</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/args">Arguments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cli">CLIs</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Common utilities</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/common">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/common/contract">Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/common/path">Path</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/common/path-resolver">PathResolver</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/common/project">Project</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/crash">Crash reporting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/debug">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/decorators">Decorators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/event">Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/log">Logging</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/pipeline">Pipelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/plugin">Plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/terminal">Terminal utilities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/translate">Translations</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/milesj/boost/blob/master/CHANGELOG.md" target="_blank" rel="noreferrer noopener" class="menu__link">Changelog</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Pipelines</h1></header><div class="markdown"><span class="badgeGroup_1h1n"><span class="badge badge--warning">Backend</span><span class="badge badge--primary">Tooling</span></span><p>Pipe an input through a series of type-safe routines and tasks to produce an output, or simply, run
logic in a series of stages.</p><h2 id="installation">Installation</h2><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1w39 tabs__item--active" style="outline:none">Yarn</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39" style="outline:none">NPM</li></ul><div role="tabpanel" class="margin-vert--md"><div><pre><code class="language-bash">yarn add @boost/pipeline
</code></pre></div></div></div><h2 id="events">Events</h2><table><thead><tr><th>Event</th><th>Arguments</th><th>Description</th></tr></thead><tbody><tr><td><code>Pipeline#onAfterRun</code></td><td></td><td>Called after the pipeline executes work units.</td></tr><tr><td><code>Pipeline#onBeforeRun</code></td><td><code>input: Input</code></td><td>Called before the pipeline executes work units.</td></tr><tr><td><code>Pipeline#onRunWorkUnit</code></td><td><code>work: WorkUnit, input: Input</code></td><td>Called before a single work unit is executed.</td></tr><tr><td><code>Routine#onCommand</code></td><td><code>command: string, args: string[]</code></td><td>Called after <code>execa</code> was executed.</td></tr><tr><td><code>Routine#onCommandData</code></td><td><code>command: string, line: string</code></td><td>Called while a command is being executed.</td></tr><tr><td><code>WorkUnit#onFail</code></td><td><code>error: Error</code></td><td>Called when an execution fails.</td></tr><tr><td><code>WorkUnit#onPass</code></td><td><code>output: Output</code></td><td>Called when an execution succeeds.</td></tr><tr><td><code>WorkUnit#onRun</code></td><td><code>input: Input</code></td><td>Called before a work unit is executed. Can return <code>true</code> to skip the work unit.</td></tr><tr><td><code>WorkUnit#onSkip</code></td><td><code>input: Input</code></td><td>Called when an execution is skipped.</td></tr></tbody></table><h2 id="pipelines">Pipelines</h2><p>A pipeline can be used to process an input, either in parallel or serial, through a series of
actions known as work units, to produce an output. If you don&#x27;t need an input, but merely need to
process work in stages, the pipeline supports that as well. There are multiple types of
<a href="#work-types">work units</a> and <a href="#pipeline-types">pipelines</a>, so choose the best one for each use
case.</p><p>To begin, instantiate a pipeline with a <a href="#contexts">context</a>, and an <em>optional</em> input value.</p><pre><code class="language-ts">import { Context, ConcurrentPipeline } from &#x27;@boost/pipeline&#x27;;
import { referenceFunction } from &#x27;./example&#x27;;

const input = 123;
const pipeline = new ConcurrentPipeline(new Context(), input);
</code></pre><p>Once instantiated, we must register work units (either a <a href="#task">task</a> or <a href="#routine">routine</a>) that
will process the input value, either with <code>ParallelPipeline#add()</code> or <code>SerialPipeline#pipe()</code>. All
work units require a descriptive title, and are passed the context and current value when being
executed.</p><pre><code class="language-ts">// Tasks
pipeline.add(&#x27;Task using an anonymous function&#x27;, (context, value) =&gt; value);
pipeline.add(&#x27;Task using a function reference&#x27;, referenceFunction);
pipeline.add(new Task(&#x27;Task using a class instance&#x27;, referenceFunction));

// Routines
pipeline.add(new ExampleRoutine(&#x27;key&#x27;, &#x27;Explicit routine using a class instance&#x27;));
</code></pre><p>And to finish, we can execute our pipeline to process each work unit and produce the final output
value.</p><pre><code class="language-ts">const output = await pipeline.run();
</code></pre><h3 id="contexts">Contexts</h3><p>A <code>Context</code> is merely a plain class that provides contextual information to all work units, and is
passed as the 1st argument when executing. It&#x27;s highly encouraged to create custom contexts with
typed properties, helper methods, and more.</p><pre><code class="language-ts">import { Context } from &#x27;@boost/pipeline&#x27;;

export default class ProcessContext extends Context {
  readonly cwd: string;

  readonly root: string;

  constructor(root: string, cwd?: string) {
    this.cwd = cwd || process.cwd();
    this.root = root;
  }
}
</code></pre><blockquote><p>A good example of context usage can be found in the
<a href="https://github.com/beemojs/beemo/tree/master/packages/core/src/contexts">Beemo project</a>.</p></blockquote><p>A unique feature of contexts is the ability to deep clone itself using <code>Context#clone()</code>. This
method is extremely useful when a context of the same shape must be passed to another pipeline
without collisions or mutations occurring.</p><pre><code class="language-ts">const newContext = context.clone();
</code></pre><h3 id="input--output-types">Input &amp; output types</h3><p>The input type is inferred from the 2nd constructor argument, while the output type defaults to the
input type. If you need to customize either the input or output type manually, the pipeline generics
can be customized upon instantiation.</p><pre><code class="language-ts">const pipeline = new ConcurrentPipeline&lt;Context, number, string[]&gt;(new Context(), 123);
</code></pre><h2 id="work-types">Work types</h2><p>There are 2 types of work units that can be registered in a pipeline.</p><h3 id="task"><code>Task</code></h3><p>A task is simply a function/method (in any form) that accepts an input and returns an output. It can
be represented by a standard function or a <code>Task</code> instance.</p><pre><code class="language-ts">import { Context } from &#x27;@boost/pipeline&#x27;;

function task(context: Context, value: number): string {
  return value.toLocaleString();
}

parallelPipeline.add(&#x27;A title for this task&#x27;, task);
</code></pre><pre><code class="language-ts">import { Context, Task } from &#x27;@boost/pipeline&#x27;;

const task = new Task(&#x27;A title for this task&#x27;, (context: Context, value: number) =&gt;
  value.toLocaleString(),
);

serialPipeline.pipe(task);
</code></pre><h3 id="routine"><code>Routine</code></h3><p>A <code>Routine</code> is a specialized work unit implemented with a class. It provides helper methods, the
ability to create nested hierarchical pipelines, and an implicit encapsulation of similar logic and
tasks.</p><p>To begin, import the <code>Routine</code> class and implement the <code>Routine#blueprint()</code> and <code>Routine#execute()</code>
methods. The class requires 3 generics to be defined, starting with an output type (defaults to
<code>unknown</code>), an input type (defaults to <code>unknown</code>), and an options interface (defaults to an empty
object).</p><p>The <code>Routine#blueprint()</code> method is inherited from <a href="/docs/common#contract"><code>Contract</code></a>, and should
return an object that matches the structure of the generic options interface. The
<code>Routine#execute()</code> method should accept the input type and return the expected output type.</p><pre><code class="language-ts">import { Blueprint, Predicates, Bind } from &#x27;@boost/common&#x27;;
import { Routine } from &#x27;@boost/pipeline&#x27;;

interface ExampleOptions {
  limit?: number;
}

type Input = number;
type Output = string;

export default class ExampleRoutine extends Routine&lt;Output, Input, ExampleOptions&gt; {
  blueprint({ number }: Predicates): Blueprint&lt;ExampleOptions&gt; {
    return {
      limit: number(10),
    };
  }

  async execute(context: Context, value: Input): Promise&lt;Output&gt; {
    return this.createWaterfallPipeline(context, value)
      .pipe(&#x27;Rounding to cents&#x27;, this.roundToCents)
      .pipe(&#x27;Converting to readable format&#x27;, this.makeReadable)
      .pipe(&#x27;Adding currency&#x27;, this.addCurrency)
      .run();
  }

  @Bind
  roundToCents(context: Context, value: number): number {
    return Number(value.toFixed(2));
  }

  @Bind
  makeReadable(context: Context, value: number): string {
    return value.toLocaleString();
  }

  @Bind
  addCurrency(context: Context, value: string): string {
    return `$${value}`;
  }
}
</code></pre><p>When instantiating a routine, a unique key and title must be provided, both of which are primarily
used for streaming to a console. An options object can be passed as the 3rd argument.</p><pre><code class="language-ts">new ExampleRoutine(&#x27;key&#x27;, &#x27;Custom title here&#x27;, { limit: 5 });
</code></pre><h4 id="creating-hierarchical-pipelines">Creating hierarchical pipelines</h4><p>The most prominent feature of <code>Routine</code> is the ability to create hierarchical pipelines that can be
nested or executed in any fashion. This can be achieved with the
<code>Routine#createAggregatedPipeline()</code>, <code>createConcurrentPipeline()</code>, <code>createPooledPipeline()</code>, and
<code>createWaterfallPipeline()</code> methods, all of which require a <a href="#contexts">context</a> and an initial
value.</p><pre><code class="language-ts">class ExampleRoutine extends Routine&lt;Item[]&gt; {
  async execute(context: Context, items: Item[]): Promise&lt;Item[]&gt; {
    return this.createConcurrentPipeline(context, [])
      .add(&#x27;Load items from cache&#x27;, this.loadItemsFromCache)
      .add(&#x27;Fetch remote items&#x27;, this.fetchItems)
      .add(&#x27;Sort and enqueue items&#x27;, () =&gt; {
        return this.createWaterfallPipeline(context, items)
          .pipe(new SortRoutine(&#x27;sort&#x27;, &#x27;Sorting items&#x27;))
          .pipe(new QueueRoutine(&#x27;queue&#x27;, &#x27;Enqueueing items&#x27;))
          .run(),
      })
      .run();
  }
}
</code></pre><p>The <code>Routine#depth</code> property denotes the current depth within the hierarchy tree, while
<code>Routine#index</code> is the current index amongst all work at the same depth.</p><h4 id="executing-local-binaries">Executing local binaries</h4><p>The <code>Routine#executeCommand()</code> method can be used to execute binaries and commands on the host
machine (it uses <a href="https://github.com/sindresorhus/execa">execa</a> under the hood). This is extremely
useful for executing locally installed NPM/Yarn binaries.</p><pre><code class="language-ts">class ExampleRoutine extends Routine&lt;string&gt; {
  async execute(context: Context): Promise&lt;string&gt; {
    return this.executeCommand(&#x27;babel&#x27;, [&#x27;./src&#x27;, &#x27;--out-dir&#x27;, &#x27;./lib&#x27;], {
      preferLocal: true,
    }).then((result) =&gt; result.stdout);
  }
}
</code></pre><h2 id="pipeline-types">Pipeline types</h2><p>There are 4 types of pipelines, grouped into parallel and serial based patterns.</p><h3 id="parallel">Parallel</h3><p>Parallel pipelines register work units with <code>ParallelPipeline#add()</code>, and process the work units in
parallel when executing <code>ParallelPipeline#run()</code>.</p><h3 id="concurrentpipeline"><code>ConcurrentPipeline</code></h3><p>Executes all work units in parallel, and returns a list of values once all resolve. If an error
occurs, the pipeline will be interrupted.</p><pre><code class="language-ts">import { Context, ConcurrentPipeline } from &#x27;@boost/pipeline&#x27;;

const pipeline = new ConcurrentPipeline(new Context(), initialValue)
  .add(&#x27;First task&#x27;, doSomething)
  .add(&#x27;Second task&#x27;, anotherSomething)
  .add(&#x27;Final task&#x27;, finalSomething);

const values = await pipeline.run();
</code></pre><blockquote><p>This pipeline will run <em>all</em> work units at once. If there are far too many work units, it may
degrade performance. In that case, use <a href="#pooledpipeline">PooledPipeline</a> instead.</p></blockquote><h3 id="aggregatedpipeline"><code>AggregatedPipeline</code></h3><p>Executes all work units in parallel <em>without</em> interruption, and returns an object with a list of
<code>errors</code> and <code>results</code> once all resolve.</p><pre><code class="language-ts">import { Context, AggregatedPipeline } from &#x27;@boost/pipeline&#x27;;

const pipeline = new AggregatedPipeline(new Context(), initialValue)
  .add(&#x27;First task&#x27;, doSomething)
  .add(&#x27;Second task&#x27;, anotherSomething)
  .add(&#x27;Final task&#x27;, finalSomething);

const { errors, results } = await pipeline.run();
</code></pre><blockquote><p>Like <code>ConcurrentPipeline</code>, all work units are ran at once. For performance improvements, use
<a href="#pooledpipeline">PooledPipeline</a> when dealing with a large number of work units.</p></blockquote><h3 id="pooledpipeline"><code>PooledPipeline</code></h3><p>Executes a distinct set of work units in parallel <em>without</em> interruption, based on a max concurrency
limit, until all work units have ran. Returns an object with a list of <code>errors</code> and <code>results</code> once
all resolve.</p><pre><code class="language-ts">import { Context, PooledPipeline } from &#x27;@boost/pipeline&#x27;;

const pipeline = new PooledPipeline(new Context(), initialValue)
  .add(&#x27;First task&#x27;, doSomething)
  .add(&#x27;Second task&#x27;, anotherSomething)
  .add(&#x27;Final task&#x27;, finalSomething);

const { errors, results } = await pipeline.run();
</code></pre><h4 id="options">Options</h4><p>The following options can be passed as a 3rd argument to <code>PooledPipeline</code>.</p><ul><li><code>concurrency</code> (<code>number</code>) - How many work units to process in parallel. Defaults to the number of
CPUs.</li><li><code>filo</code> (<code>boolean</code>) - Process with first-in-last-out (FILO) order, instead of first-in-first-out
(FIFO). Defaults to <code>false</code>.</li><li><code>timeout</code> (<code>number</code>) - Timeout in milliseconds that each work unit may run, or <code>0</code> to avoid a
timeout. Defaults to <code>0</code>.</li></ul><h3 id="serial">Serial</h3><p>Serial pipelines register work units in a sequence with <code>SerialPipeline#pipe()</code>, and process the
work units one by one when executing <code>SerialPipeline#run()</code>.</p><h3 id="waterfallpipeline"><code>WaterfallPipeline</code></h3><p>Executes each work unit one by one, with the return value of the previous work unit being passed as
a value argument to the next work unit. Returns the final value once all resolve.</p><pre><code class="language-ts">import { Context, WaterfallPipeline } from &#x27;@boost/pipeline&#x27;;

const pipeline = new WaterfallPipeline(new Context(), 1000)
  .pipe(&#x27;Multiply initial value&#x27;, (ctx, value) =&gt; value * 3)
  .pipe(&#x27;Convert to a readable string&#x27;, (ctx, value) =&gt; value.toLocaleString())
  .pipe(&#x27;Convert to an array for reasons unknown&#x27;, (ctx, value) =&gt; [value]);

const finalValue = await pipeline.run(); // [&#x27;3,000&#x27;]
</code></pre><h2 id="caveats">Caveats</h2><h3 id="serial-pipelines">Serial pipelines</h3><p><a href="#serial">Serial pipelines</a> are designed using a linked list, with each call to
<code>SerialPipeline#pipe()</code> returning a new instance. It was designed this way so that input and output
types would cascade correctly down the chain. However, this pattern causes issues where pipes are
called within conditionals, resulting in new pipes to be lost. For example, this is <em>invalid</em>.</p><pre><code class="language-ts">const pipeline = new WaterfallPipeline(new Context());

if (condition) {
  pipeline.pipe(&#x27;Do this&#x27;, thisAction);
} else {
  pipeline.pipe(&#x27;Do that&#x27;, thatAction);
}

await pipeline
  .pipe(&#x27;Then finish&#x27;, finishAction)
  .run();
</code></pre><p>While this is technically valid (note the <code>let</code> and <code>pipeline</code> assignment), but will break down if
types conflict.</p><pre><code class="language-ts">let pipeline = new WaterfallPipeline(new Context());

if (condition) {
  pipeline = pipeline.pipe(&#x27;Do this&#x27;, thisAction);
} else {
  pipeline = pipeline.pipe(&#x27;Do that&#x27;, thatAction);
}

await pipeline
  .pipe(&#x27;Then finish&#x27;, finishAction)
  .run();
</code></pre><p>Instead, it&#x27;s suggested to use separate pipelines within each conditional block. This approach
requires a bit of duplication, but avoids all other issues.</p><pre><code class="language-ts">if (condition) {
  await new WaterfallPipeline(new Context())
    .pipe(&#x27;Do this&#x27;, thisAction)
    .pipe(&#x27;Then finish&#x27;, finishAction)
    .run()
} else {
  await new WaterfallPipeline(new Context())
    .pipe(&#x27;Do that&#x27;, thatAction)
    .pipe(&#x27;Then finish&#x27;, finishAction)
    .run()
}
</code></pre></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/milesj/boost/edit/master/website/docs/pipeline.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/log"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">芦 Logging</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/plugin"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Plugins 禄</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link">Installation</a></li><li><a href="#events" class="table-of-contents__link">Events</a></li><li><a href="#pipelines" class="table-of-contents__link">Pipelines</a><ul><li><a href="#contexts" class="table-of-contents__link">Contexts</a></li><li><a href="#input--output-types" class="table-of-contents__link">Input &amp; output types</a></li></ul></li><li><a href="#work-types" class="table-of-contents__link">Work types</a><ul><li><a href="#task" class="table-of-contents__link"><code>Task</code></a></li><li><a href="#routine" class="table-of-contents__link"><code>Routine</code></a></li></ul></li><li><a href="#pipeline-types" class="table-of-contents__link">Pipeline types</a><ul><li><a href="#parallel" class="table-of-contents__link">Parallel</a></li><li><a href="#concurrentpipeline" class="table-of-contents__link"><code>ConcurrentPipeline</code></a></li><li><a href="#aggregatedpipeline" class="table-of-contents__link"><code>AggregatedPipeline</code></a></li><li><a href="#pooledpipeline" class="table-of-contents__link"><code>PooledPipeline</code></a></li><li><a href="#serial" class="table-of-contents__link">Serial</a></li><li><a href="#waterfallpipeline" class="table-of-contents__link"><code>WaterfallPipeline</code></a></li></ul></li><li><a href="#caveats" class="table-of-contents__link">Caveats</a><ul><li><a href="#serial-pipelines" class="table-of-contents__link">Serial pipelines</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright 漏 2020 Miles Johnson. Built with <a href="https://docusaurus.io/">Docusaurus</a>. Icon by <a href="https://thenounproject.com/search/?q=boost&i=1420345">Chameleon Design</a>.</div></div></div></footer></div>
<script src="/styles.258a4895.js"></script>
<script src="/runtime~main.c839f7c1.js"></script>
<script src="/main.aad79896.js"></script>
<script src="/1.bebaefbd.js"></script>
<script src="/2.7ed9c09b.js"></script>
<script src="/27.e0fa85a5.js"></script>
<script src="/28.5b51cd4f.js"></script>
<script src="/935f2afb.421c7848.js"></script>
<script src="/17896441.c3526068.js"></script>
<script src="/0da5837a.fcad377b.js"></script>
</body>
</html>